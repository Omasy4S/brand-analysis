# Анализ рейтинга брендов

Скрипт для обработки CSV файлов с данными о товарах и формирования отчетов по брендам.

**[Объяснение решений](EXPLANATIONS.md)** - почему код написан именно так

## Стек технологий

- **Python 3.8+** - основной язык
- **argparse** (stdlib) - обработка аргументов командной строки, автоматическая генерация help
- **csv** (stdlib) - чтение CSV файлов, DictReader для удобной работы со строками как словарями
- **pathlib** (stdlib) - современная работа с путями файлов, кроссплатформенность
- **tabulate** - единственная внешняя зависимость для красивого вывода таблиц в консоль
- **pytest** - тестирование, стандарт индустрии
- **pytest-cov** - проверка покрытия кода тестами

Выбор обусловлен требованиями задания: использовать только стандартную библиотеку для основного функционала.

## Установка

```bash
pip install -r requirements.txt
```

## Использование

Запуск скрипта с указанием файлов и типа отчета:

```bash
python main.py --files products1.csv products2.csv --report average-rating
```

### Параметры

- `--files` - пути к одному или нескольким CSV файлам с данными
- `--report` - название отчета (доступные: `average-rating`)

## Формат CSV файлов

CSV файлы должны содержать следующие колонки:
- `name` - название товара
- `brand` - бренд товара
- `price` - цена товара
- `rating` - рейтинг товара

Пример:
```
name,brand,price,rating
iphone 15 pro,apple,999,4.9
galaxy s23 ultra,samsung,1199,4.8
```

## Доступные отчеты

### average-rating
Показывает средний рейтинг по каждому бренду. Бренды сортируются по рейтингу в порядке убывания.

## Запуск тестов

```bash
pytest
```

Проверка покрытия кода тестами:

```bash
pytest --cov=. --cov-report=term-missing
```

## Добавление новых отчетов

Чтобы добавить новый отчет:

1. Создайте класс отчета в файле `reports.py`
2. Реализуйте метод `generate()` для формирования данных отчета
3. Добавьте новый отчет в словарь `AVAILABLE_REPORTS`

Пример:

```python
class AveragePriceReport:
    def generate(self, data: List[Dict[str, str]]) -> List[Dict[str, any]]:
        # Собираем цены по брендам
        brand_prices = {}
        for item in data:
            brand = item.get('brand', '').strip()
            price = float(item.get('price', '0'))
            if brand not in brand_prices:
                brand_prices[brand] = []
            brand_prices[brand].append(price)
        
        # Вычисляем среднюю цену
        result = []
        for brand, prices in brand_prices.items():
            avg_price = sum(prices) / len(prices)
            result.append({'brand': brand, 'price': round(avg_price, 2)})
        
        return result

AVAILABLE_REPORTS = {
    'average-rating': AverageRatingReport(),
    'average-price': AveragePriceReport(),
}
```

## Известные ограничения

- Все данные загружаются в память - для файлов размером в несколько ГБ потребуется другой подход
- Рейтинги валидируются в диапазоне 0-5 - это стандарт для товаров, но может не подойти для других данных
- Записи с пустым брендом или невалидным рейтингом пропускаются без предупреждения
- Нет логирования - для production стоит добавить logging вместо print()

## Что можно улучшить

Для production-версии стоит рассмотреть:

1. **Логирование** - заменить print() на logging для контроля уровней и вывода в файлы
2. **Конфигурация** - вынести настройки (диапазон рейтингов, кодировка) в config файл
3. **Потоковая обработка** - для больших файлов читать и обрабатывать данные порциями
4. **Кэширование** - сохранять результаты для повторных запросов с теми же файлами
5. **Валидация схемы** - проверять структуру CSV (наличие обязательных колонок) перед обработкой
6. **Прогресс-бар** - показывать прогресс обработки для больших файлов
7. **Экспорт результатов** - сохранение отчетов в CSV/JSON/Excel

Эти улучшения не реализованы сейчас, чтобы не переусложнять решение задания.
